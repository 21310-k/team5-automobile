H8S,H8/300 SERIES C/C++ COMPILER (V.6.02.01.000)    5-Feb-2025 16:18:04 PAGE   1

************ SOURCE LISTING ************

      Line Pi 0----+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0----+----1----+--
FILE NAME: C:\Users\s4exp\Desktop\R7a_team5\test_merge\Soft2\main.c
         1     /****************************************************************************************************************/
         2     /*  FILE        :main.c                                                                                         */
         3     /*  DATE        :Tue, Jan 17, 2012                                                                              */
         4     /*  DESCRIPTION :AGV Main Program                                                                               */
         5     /*  CPU TYPE    :H8/3052F                                                                                       */
         6     /****************************************************************************************************************/
         7     #include    "stdio.h"
         8     #define MAIN                                        /* マクロMAINの定義                                         */
         9     
        10     #include    "machine.h"                             /* 組込み関数の定義                                         */
        11     #include    "reg3052.h"                             /* H8/3052Fの内蔵モジュール定義                             */
        12     #include    "agvdef.h"                              /* 無人搬送車のデバイス定義                                 */
        13     #include    "agvvars.h"                             /* 無人搬送車の共通変数を定義                               */
        14     #include    "def_monitor_printf.h"
        15     
        16     //変数の仮定義
        17     unsigned char agv_init(void);
        18     void task_main(unsigned char agv_state);
        19     
        20     /****************************************************************************************************************/
        21     /*  AGVデバイス初期化モジュール agv_init                                                                        */
        22     /****************************************************************************************************************/
        23     /*!
        24         @brief 無人搬送車の初期化を行います
        25         @param void
        26         @return void
        27         @details 無人搬送車の初期化を行います
        28     */
        29     
        30     unsigned char agv_init(void)
        31     {
        32         
        33         /*ハードウェアの初期化*/
        34         MOTOR_STATE = MOTOR_STOP;        /*モータの停止*/
        35         bios_led_output(0x00);         /*LEDの消灯*/
        36         bios_da_output(HANDLE_CENTER);  /*ハンドルを中心に移動する*/
        37         AGV_STATE = AGV_BOOT;        /*起動モード*/
        38         
        39         /*ITU0の初期化*/
        40         TCR0=0xa0;    /*GRA0で内部クロックφでコンペアマッチ*/
        41         TIOR0=0x8b;   /*GRA0はアウトプットコンペアレジスタとして使用*/
        42         GRA0=649;     /*100μs*/
        43          
        44         /*ITU1の初期化*/
        45         TCR1=0xa6;    /*外部クロックCを使用*/
        46         TIER1|=0xf9;  /*ITU1は割込みを行う*/
        47          
        48         /*ITU2の初期化*/
        49         TCR2=0xa6;    /*外部クロックCを使用*/
        50         TIER2|=0xf9;  /*ITU2は割込みを行う*/
        51         GRA2=99;      /*100μs×100=10ms*/
        52          
        53         /*ITU3の初期化*/
        54         TCR3=0xa6;    /*外部クロックCを使用*/
        55         TIER3|=0xf9;  /*ITU3は割込みを行う*/
        56         GRA3=9;        /*100μs×10=1ms*/
        57     
        58         IPRA|=0x02;  /*ITU1の割込みをプライオリティレベル1に設定*/
        59         SYSCR&=~0x08;          /*SYSCRのUIビットをクリア*/
        60         and_ccr(~0x80);        /*すべての割込み許可*/
        61         TSTR|=0x0d;            /*ITU0,2,3をスタートする*/
        62     }
        63     
        64     
        65     
        66     /****************************************************************************************************************/
        67     /*  main関数                                                                                                    */
        68     /****************************************************************************************************************/
        69     int main(void){
        70         while(-1){
        71             task_main(AGV_STATE);
        72             
        73         }
        74         return(0);
        75     }
        76     
        77     void task_main(unsigned char agv_state) {
        78         
        79         counter++;
        80         
        81         if(counter>1000){
        82             counter=0;
        83         }
        84         switch (agv_state) {
        85             
        86             case AGV_READY_ALM:
        87                 break;
        88                 
        89             case AGV_BOOT_ALM:
        90                 break;
        91                 
        92             case AGV_RUN_ALM:
        93                 if (counter < 500) { // 1秒の間隔で点滅（500ms ON, 500ms OFF）
        94                     bios_led_output(0xFF); // LEDを点灯
        95                     bios_beep_output(1); // ブザーをON
        96                 } else {
        97                     bios_led_output(0x00); // LEDを消灯
        98                     bios_beep_output(0); // ブザーをOFF
        99                 }
       100                 break;
       101      
       102             default: // それ以外の状態
       103                 bios_led_output(0x00); // LEDを全部消灯
       104                 bios_beep_output(0); // ブザーをOFF
       105                 break;
       106         }
       107     }
       108     
       109     
       110     
       111     


H8S,H8/300 SERIES C/C++ COMPILER (V.6.02.01.000)    5-Feb-2025 16:18:04 PAGE   1

******* SECTION SIZE INFORMATION *******

PROGRAM  SECTION(P):                                0x000000C0 Byte(s)
CONSTANT SECTION(C):                                0x00000000 Byte(s)
DATA     SECTION(D):                                0x00000004 Byte(s)
BSS      SECTION(B):                                0x00000002 Byte(s)

TOTAL PROGRAM  SECTION: 0x000000C0 Byte(s)
TOTAL CONSTANT SECTION: 0x00000000 Byte(s)
TOTAL DATA     SECTION: 0x00000004 Byte(s)
TOTAL BSS      SECTION: 0x00000002 Byte(s)

    TOTAL PROGRAM SIZE: 0x000000C6 Byte(s)



** ASSEMBLER/LINKAGE EDITOR LIMITS INFORMATION **

NUMBER OF EXTERNAL REFERENCE  SYMBOLS:        5 
NUMBER OF EXTERNAL DEFINITION SYMBOLS:        8 
NUMBER OF INTERNAL/EXTERNAL SYMBOLS:         18 



**** COMPILE CONDITION INFORMATION ****

COMMAND LINE: -cpu=300HA:20 -object=C:\Users\s4exp\Desktop\R7a_team5\test_merge\Soft2\Debug\main.obj -debug -list=C:\Users\s4exp\Desktop\R7a_team5\test_merge\Soft2\Debug\main.lst -show=tab=4 -chgincpath C:\Users\s4exp\Desktop\R7a_team5\test_merge\Soft2\main.c -lang=c -nologo
CPU         : 300ha:20
